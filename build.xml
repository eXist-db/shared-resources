<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="all" name="shared-resources">
    <property name="app.name" value="shared-resources"/>
    <property name="app.version" value="0.3.0"/>
    <property name="tools" value="./tools"/>
    <property name="build" value="./build"/>
    <property name="scripts" value="./resources/scripts"/>
    <property name="ace" value="${scripts}/ace"/>
    <property name="ace.src" value="./support/ace"/>
    <property name="server.url" value="http://demo.exist-db.org/exist/apps/public-repo/public/"/>

    <condition property="git.commit" value="${git.commit}" else="">
      <isset property="git.commit" />      
    </condition>

    <target name="all" depends="ace,xar"/>

    <target name="rebuild" depends="clean,all"/>

    <target name="ace">
        <mkdir dir="${ace}"/>
        <copy todir="${ace}">
            <fileset dir="${ace.src}/build/src-min"/>
        </copy>
    </target>

    <target name="clean">
        <delete dir="${ace}"/>
        <delete dir="${build}"/>
    </target>

    <target name="xar">
        <mkdir dir="${build}"/>
        <zip destfile="${build}/${app.name}-${app.version}${git.commit}.xar">
            <fileset dir=".">
                <include name="*.*"/>
                <include name="resources/**"/>
                <include name="content/**"/>
                <exclude name=".git*"/>
            </fileset>
        </zip>
    </target>
    <target name="upload">
        <input message="Enter password:" addproperty="server.pass" defaultvalue="">
            <handler type="secure"/>
        </input>
        <property name="xar" value="${app.name}-${app.version}.xar"/>
        <exec executable="curl">
            <arg line="-T ${build}/${xar} -u admin:${server.pass} ${server.url}/${xar}"/>
        </exec>
    </target>
</project>
